#!/bin/sh

KDIR=${KDIR:-/lib/modules/`uname -r`/build}

make -C ${KDIR} M=$(pwd) modules > /dev/null 2>&1

if [ $? -eq 0 ] ; then
    echo "#if defined(BLKDEV_ZERO_NOUNMAP) || defined(BLKDEV_ZERO_NOFALLBACK)"
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_FLAGS 1"
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_DISCARD 0"
    echo "#else"
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_FLAGS 0"
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_DISCARD 1"
    echo "#endif"
else
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_FLAGS 0"
    echo "#define HAVE_BLKDEV_ISSUE_ZEROOUT_DISCARD 0"
fi
